on: [push]

jobs:
  install_fdb:
    name: Install foundationdb

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v1

      - name: Install FoundationDB
        uses: ./

      - name: Change foundationdb dirs
        if: matrix.os == 'windows-latest'
        run: |
          Stop-Service fdbmonitor
          mkdir D:\fdblogs
          mkdir D:\fdbdata
          $filecontent = Get-Content C:\ProgramData\foundationdb\foundationdb.conf
          $filecontent = $filecontent -replace '(^logdir=).*','$1D:\fdblogs'
          $filecontent -replace '(^datadir=).*','$1D:\fdbdata\$ID' | Set-Content C:\ProgramData\foundationdb\foundationdb.conf
          cat C:\ProgramData\foundationdb\foundationdb.conf
          Start-Service fdbmonitor
          sleep 5
          fdbcli --exec 'configure new single ssd'

      - name: foundationdb status
        if: matrix.os == 'windows-latest'
        run: fdbcli --exec status
